<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Split Classical Piano (Wicki-Hayden)</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéπ</text></svg>">
    
    <link rel="stylesheet" href="piano.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://unpkg.com/@tonejs/midi"></script>
  </head>
  <body>
    
    <div id="drop-zone">
      <div class="drop-text">DROP MIDI FILE HERE</div>
    </div>
    
    <div id="controls">
      <div class="control-group">
        <span class="control-label">Labels</span>
        <button class="control-btn" style="width: 80px; font-size: 11px;" onclick="cycleLabels()" id="btn-labels">NOTES</button>
      </div>
      
      <div class="control-group">
        <span class="control-label">Board</span>
        <button class="control-btn" style="width: 80px; font-size: 11px;" onclick="toggleBoard()" id="btn-board">HIDE</button>
      </div>
      
      <div class="control-group">
        <span class="control-label">F-Keys</span>
        <button class="control-btn" style="width: 80px; font-size: 11px;" onclick="toggleFKeys()" id="btn-fkeys">F3-F12</button>
      </div>
      
      <div class="control-group">
        <span class="control-label">Recorder</span>
        <div class="btn-row">
          <button class="control-btn" id="btn-record" onclick="toggleRecording()" title="Record">‚óè</button>
          <button class="control-btn" id="btn-play" onclick="togglePlayback()" title="Play">‚ñ∂</button>
          <button class="control-btn" id="btn-pause" onclick="pausePlayback()" title="Pause" disabled>II</button>
        </div>
      </div>

      <div class="control-group playback-controls">
         <select id="record-select" onchange="changeRecording(this.value)">
           <option value="-1">No Records</option>
         </select>
         <div id="progress-container">
            <input type="range" id="progress-bar" min="0" max="100" value="0" oninput="scrubProgress(this.value)">
         </div>
      </div>

      <div class="control-group">
        <span class="control-label">Metronome</span>
        <div class="btn-row">
          <button class="control-btn" id="btn-metro" onclick="toggleMetronome()" title="Toggle Click">M</button>
          <input type="number" id="input-bpm" value="120" onchange="updateBPM(this.value)" 
                 style="width: 40px; background: rgba(111,111,111,0.3); border: none; color: white; border-radius: 4px; padding: 4px; font-weight: bold; text-align: center;">
        </div>
      </div>
      
      <div class="control-group">
        <div style="display: flex; gap: 10px;">
          <div style="display:flex; flex-direction:column; align-items:center;">
            <span class="side-label">LEFT</span>
            <div class="btn-row">
              <button class="control-btn" onclick="changeTranspose('left', -1)">-</button>
              <span class="control-val" id="disp-trans-l">0</span>
              <button class="control-btn" onclick="changeTranspose('left', 1)">+</button>
            </div>
          </div>
          <div style="display:flex; flex-direction:column; align-items:center;">
            <span class="side-label">RIGHT</span>
            <div class="btn-row">
              <button class="control-btn" onclick="changeTranspose('right', -1)">-</button>
              <span class="control-val" id="disp-trans-r">0</span>
              <button class="control-btn" onclick="changeTranspose('right', 1)">+</button>
            </div>
          </div>
        </div>
      </div>

     <div class="control-group" style="display: none;">
      <span class="side-label" style="margin-top: 5px;">transequence</span>
      <input type="text" id="input-sequence" 
             value="-5:-5 -12:0 5:5 12:12 -17:-17 17:5" 
             style="width: 300px; background: #222; color: white; border: 1px solid #666; border-radius: 4px; padding: 4px; font-size: 11px; text-align: center;">
    </div>

    <div class="control-group">
        <span class="control-label">Visuals</span>
        <button class="control-btn" style="width: 80px; font-size: 11px;" onclick="toggleVisuals()" id="btn-visuals">ON</button>
      </div>
    </div>

    <canvas id="synthesia-canvas"></canvas>

    <div id="board-wrapper">
      <div class="wicki-board" id="board-left"></div>
      <div class="wicki-board" id="board-right"></div>
    </div>

    <div id="piano-strip"></div>
    
    <script src="piano_core.js"></script>
    <script src="visual_state.js"></script>
    <script src="visual_render.js"></script>
    <script src="playback_engine.js"></script>
    <script src="piano_render.js"></script> 
    <script src="piano_interaction.js"></script>
    <script src="piano_midi.js"></script>
  </body>
</html>